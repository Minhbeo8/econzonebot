<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è EconZone Dashboard</title>
    <style>
        :root {
            --bg-color: #f4f7f9; --card-bg-color: #ffffff; --text-color: #333; --header-color: #5a677d; --primary-color: #4a90e2;
            --success-color: #2e8b57; --danger-color: #d9534f; --info-color: #4682b4; --warning-color: #f0ad4e;
            --border-radius: 8px; --box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; }
        .container { max-width: 1200px; margin: 2em auto; padding: 0 2em; }
        header { text-align: center; margin-bottom: 2em; }
        header h1 { color: var(--header-color); font-weight: 600; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5em; margin-bottom: 2em; }
        .stat-card { background: var(--card-bg-color); padding: 1.5em; border-radius: var(--border-radius); box-shadow: var(--box-shadow); text-align: center; }
        .stat-card h3 { margin-top: 0; color: var(--primary-color); }
        .stat-card .value { font-size: 2em; font-weight: 700; }
        .section { background: var(--card-bg-color); padding: 2em; border-radius: var(--border-radius); box-shadow: var(--box-shadow); margin-bottom: 2em; }
        .section h2 { margin-top: 0; border-bottom: 2px solid var(--bg-color); padding-bottom: 0.5em; }
        button { background-color: var(--primary-color); color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: 600; transition: background-color 0.2s; }
        button:hover { background-color: #357abd; }
        table { width: 100%; border-collapse: collapse; margin-top: 1em; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f9f9f9; }
        .flashes { list-style: none; padding: 0; }
        .flashes li { padding: 1em; margin-bottom: 1em; border-radius: 5px; border-left: 5px solid; }
        .flashes .success { background: #e9f7ef; color: #2d6a4f; border-color: var(--success-color); }
        .flashes .danger { background: #fdecea; color: #a51c1c; border-color: var(--danger-color); }
        .flashes .info { background: #e7f3fe; color: #31708f; border-color: var(--info-color); }
        .flashes .warning { background: #fef8e7; color: #8a6d3b; border-color: var(--warning-color); }
        pre { background: #eee; padding: 1em; border: 1px solid #ccc; white-space: pre-wrap; word-wrap: break-word; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öôÔ∏è B·∫£ng ƒêi·ªÅu Khi·ªÉn EconZone</h1>
            <p>Xin ch√†o, <strong>{{ session['user_id'] }}</strong>! Ch√∫c m·ªôt ng√†y l√†m vi·ªác hi·ªáu qu·∫£.</p>
        </header>
        <div class="stats-grid">
            <div class="stat-card"><h3>üìä Tr·∫°ng th√°i CSDL</h3><p class="value">{{ current_db_type.upper() }}</p></div>
            <div class="stat-card"><h3>üë• T·ªïng s·ªë ng∆∞·ªùi d√πng</h3><p class="value">{{ "{:,}".format(user_count) }}</p></div>
        </div>
        <div class="section">
            <h2>‚ö° H√†nh ƒê·ªông Qu·∫£n Tr·ªã</h2>
            <p>S·ª≠ d·ª•ng n√∫t b√™n d∆∞·ªõi ƒë·ªÉ di chuy·ªÉn d·ªØ li·ªáu t·ª´ file <code>economy.json</code> sang CSDL SQLite. ƒê√¢y l√† h√†nh ƒë·ªông ch·ªâ n√™n th·ª±c hi·ªán m·ªôt l·∫ßn.</p>
            <form action="/migrate" method="post" onsubmit="return confirm('C·∫¢NH B√ÅO: H√†nh ƒë·ªông n√†y s·∫Ω ƒë·ªçc file JSON v√† ghi ƒë√® v√†o CSDL SQLite. D·ªØ li·ªáu hi·ªán c√≥ trong SQLite s·∫Ω b·ªã X√ìA. B·∫°n c√≥ ch·∫Øc mu·ªën ti·∫øp t·ª•c kh√¥ng?');">
              <button type="submit">üöÄ Ch·∫°y Script Di Chuy·ªÉn D·ªØ Li·ªáu</button>
            </form>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="section">
                <h2>üîî Th√¥ng B√°o</h2>
                <ul class=flashes>
                {% for category, message in messages %}
                  <li class="{{ category }}">{{ message | safe }}</li>
                {% endfor %}
                </ul>
            </div>
          {% endif %}
        {% endwith %}
        <div class="section">
            <h2>üèÜ Top 10 Ng∆∞·ªùi D√πng Gi√†u Nh·∫•t (Bank)</h2>
            <table>
                <thead><tr><th>#</th><th>User ID</th><th>üí∞ S·ªë d∆∞ Bank</th></tr></thead>
                <tbody>
                {% for user in top_users %}
                    <tr><td>{{ loop.index }}</td><td>{{ user['user_id'] }}</td><td>{{ "{:,}".format(user['bank_balance']) }}</td></tr>
                {% else %}
                    <tr><td colspan="3" style="text-align:center;">Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
